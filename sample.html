<!DOCTYPE html>
<meta charset="utf-8">

<style>
.base 
{
    background: #101010;
}
path 
{
  fill: none;
  stroke: #ccf;
  stroke-width: .5px;
}

</style>

<body class="base">

<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>

<script>

var width = 1600,
    height = 800;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

// var projection = d3.geo.equirectangular()
var projection = d3.geo.aitoff()
    .scale(180)
    .translate([width / 2, height / 2])
    .precision(.1);

//パスジェネレーター
var path = d3.geo.path().projection(projection);
//グリッド線追加    
var graticule = d3.geo.graticule();
var grid = svg.append("path")
    .datum(graticule)
    .attr({
        "class": "graticule",
        "d": path,
        "fill": "none",
        "stroke": "#444",
        "stroke-width": ".1px",
        "stroke-opacity": 0.1
    });

// 描画の定義
var pointRadius = function(d)
{
    if (d[2]['vMag'] < 1) 
    {
        return 1.6;
    } else if (d[2]['vMag'] < 2) 
    {
        return 1.2;
    } else if (d[2]['vMag'] < 3) 
    {
        return 1.0;
    } else if (d[2]['vMag'] < 4) 
    {
        return 0.8;
    } else if (d[2]['vMag'] < 5) 
    {
        return 0.6;
    } else if (d[2]['vMag'] < 6) 
    {
        return 0.4;
    }
    return 0.2
};
var pointColor = function(d)
{
    var opacity = 0.2;
    if (d[2]['vMag'] < 1) 
    {
        opacity = 1;
    } else if (d[2]['vMag'] < 2) 
    {
        opacity = 1;
    } else if (d[2]['vMag'] < 3) 
    {
        opacity = 0.8;
    } else if (d[2]['vMag'] < 4) 
    {
        opacity = 0.5;
    } else if (d[2]['vMag'] < 5) 
    {
        opacity = 0.4;
    } else if (d[2]['vMag'] < 6) 
    {
        opacity = 0.3;
    }
    return "rgba(240, 240, 100, " + Math.pow(d[2]['vMag'], -1) + ")"; 
};

// 座標にマッピング
d3.json("data/hip.json", function(error, catalogue) 
{
   if (error) throw error;
    // console.log(JSON.stringify(catalogue));
    var point = svg.selectAll(".point")
        .data(catalogue.data)
        .enter()
        .append("circle")
        .attr({
            "cx":function(d) { return projection(d)[0]; },
            "cy":function(d) { return projection(d)[1]; },
            "r":pointRadius,
            "fill":pointColor
        });
});
</script>

</body>
</html>
